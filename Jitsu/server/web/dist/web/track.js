!function(){"use strict";var e=function(){return(e=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function t(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<n;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,i++)o[i]=r[s];return o}var n,o=function(e){return e&&decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},i=function(e,t,n,o,i){var r=n===1/0?" expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;document.cookie=encodeURIComponent(e)+"="+t+"; path=/;"+r+(o?"; domain="+o:"")+(i?"; secure":"")},r=function(){return Math.random().toString(36).substring(2,7)},s=function(e){for(var t=e||window.location.search.substring(1),n={},o=("?"===t[0]?t.substr(1):t).split("&"),i=0;i<o.length;i++){var r=o[i].split("=");n[decodeURIComponent(r[0])]=decodeURIComponent(r[1]||"")}return n},a={utm_source:"source",utm_medium:"medium",utm_campaign:"campaign",utm_term:"term",utm_content:"content"},c={gclid:!0,fbclid:!0,dclid:!0};function d(e,t,n){return void 0===t&&(t=500),void 0===n&&(n=4),function e(t,n,o,i){return void 0===o&&(o=500),void 0===i&&(i=4),new Promise((function(r,s){t()?r(n()):0!==i?setTimeout((function(){e(t,n,o,i-1).then(r).catch(s)}),o):s("condition rejected")}))}((function(){return void 0!==window[e]}),(function(){return window[e]}),t,n)}var u=!1;var l={cc:"campaign_context",cid:"client_id",cm:"campaign_medium",cn:"campaign_name",cos:"checkout_step",cs:"campaign_source",de:"document_encoding",dh:"hostname",dl:"url",dp:"path",dr:"referrer",ds:"datasource",dt:"document_title",ea:"event_action",ec:"event_category",el:"event_label",ev:"event_value",ic:"item_code",in:"item_name",ip:"item_price",iq:"item_quality",iv:"item_category",je:"java_installed",sc:"session_control",sd:"screen_color",sr:"screen_size",t:"event_type",tcc:"coupon_code",ti:"transaction_id",tid:"ga_property",tr:"transaction_revenue",ts:"transaction_shipping",tt:"transaction_tax",ua:"user_agent_override",uid:"user_id",uip:"user_ip_override",ul:"user_language",v:"ga_protocol_version",vp:"viewport_size",_gid:"ga_user_id"},p=function(e){return Object.entries(e).reduce((function(e,t){var n=t[0],o=t[1],i=l[n];return void 0!==i&&(e[i]=o),e}),{})},g={DEBUG:{name:"DEBUG",severity:10},INFO:{name:"INFO",severity:100},WARN:{name:"WARN",severity:1e3},ERROR:{name:"ERRO",severity:1e4}};function h(e){var n=window.__eventNLogLevel,o=g.WARN;if(n){var i=g[n.toUpperCase()];i&&i>0&&(o=i)}else e&&(o=e);var r={minLogLevel:o};return Object.values(g).forEach((function(e){var n=e.name,i=e.severity;r[n.toLowerCase()]=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(i>=o.severity&&e.length>0){var s=e[0],a=e.splice(1);"DEBUG"===n||"INFO"===n?console.log.apply(console,t([s],a)):"WARN"===n?console.warn.apply(console,t([s],a)):console.error.apply(console,t([s],a))}}})),window.__eventNLogger=r,r}var _="__buildVersion__"+"/"+"__buildEnv__"+"@"+"__buildDate__",v=function(){function e(e,t){this.cookieDomain=e,this.cookieName=t}return e.prototype.save=function(e){i(this.cookieName,encodeURIComponent(JSON.stringify(e)),1/0,this.cookieDomain,"http:"!==document.location.protocol)},e.prototype.restore=function(){var e=o(this.cookieName);if(e)try{return JSON.parse(decodeURIComponent(e))}catch(t){return void console.error("Failed to decode JSON from "+e,t)}},e}(),m=function(){function t(){this.logger=h(),this.anonymousId="",this.userProperties={},this.cookieDomain="",this.trackingHost="",this.idCookieName="",this.randomizeUrl=!1,this.apiKey="",this.initialized=!1,this._3pCookies={}}return t.prototype.id=function(t,n){return this.userProperties=e(e({},this.userProperties),t),this.logger.debug("user identified:",t),this.userIdPersistance?this.userIdPersistance.save(t):this.logger.warn("Id() is called before initialization"),n?Promise.resolve():this.track("user_identify",{})},t.prototype.getAnonymousId=function(){var e=o(this.idCookieName);if(e)return this.logger.debug("Existing user id",e),e;var t=Math.random().toString(36).substring(2,12);return this.logger.debug("New user id",t),i(this.idCookieName,t,1/0,this.cookieDomain,"http:"!==document.location.protocol),t},t.prototype.makeEvent=function(t,n,o){return this.restoreId(),e({api_key:this.apiKey,src:n,event_type:t,eventn_ctx:this.getCtx()},o)},t.prototype._send3p=function(e,t,n){var o="3rdparty";n&&""!==n&&(o=n);var i=this.makeEvent(o,e,{src_payload:t});return this.sendJson(i)},t.prototype.sendJson=function(e){var t,n=this,o=this.trackingHost+"/api/v1/event?token="+this.apiKey;this.randomizeUrl&&(o=this.trackingHost+"/api."+r()+"?p_"+r()+"="+this.apiKey);var i=JSON.stringify(e);if((null===(t=this.initialOptions)||void 0===t?void 0:t.use_beacon_api)&&navigator.sendBeacon){this.logger.debug("Sending beacon",e);var s=new Blob([i],{type:"text/plain"});return navigator.sendBeacon(o,s),Promise.resolve()}var a=new XMLHttpRequest;return new Promise((function(t,r){a.onerror=function(t){n.logger.error("Failed to send",e,t),r(new Error("Failed to send JSON. See console logs"))},a.onload=function(){200!==a.status&&(n.logger.error("Failed to send data:",e,a.statusText,a.responseText),r(new Error("Failed to send JSON. Error code: "+a.status+". See logs for details"))),t()},a.open("POST",o),a.setRequestHeader("Content-Type","application/json"),a.send(i),n.logger.debug("sending json",e)}))},t.prototype.getCtx=function(){var t,n,o=new Date;return e({event_id:"",user:e({anonymous_id:this.anonymousId},this.userProperties),ids:this._getIds(),user_agent:navigator.userAgent,utc_time:(t=o.toISOString(),n=t.split(".")[1],n?n.length>=7?t:t.slice(0,-1)+"0".repeat(7-n.length)+"Z":t),local_tz_offset:o.getTimezoneOffset(),referer:document.referrer,url:window.location.href,page_title:document.title,doc_path:document.location.pathname,doc_host:document.location.hostname,doc_search:window.location.search,screen_resolution:screen.width+"x"+screen.height,vp_size:Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)+"x"+Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),user_language:navigator.language,doc_encoding:document.characterSet},function(e){var t={utm:{},click_id:{}};for(var n in e)if(e.hasOwnProperty(n)){var o=e[n],i=a[n];i?t.utm[i]=o:c[n]&&(t.click_id[n]=o)}return t}(s()))},t.prototype._getIds=function(){for(var e=function(e){if(void 0===e&&(e=!1),e&&n)return n;for(var t={},o=document.cookie.split(";"),i=0;i<o.length;i++){var r=o[i],s=r.indexOf("=");s>0&&(t[r.substr(i>0?1:0,i>0?s-1:s)]=r.substr(s+1))}return n=t,t}(!1),t={},o=0,i=Object.entries(e);o<i.length;o++){var r=i[o],s=r[0],a=r[1];this._3pCookies[s]&&(t["_"==s.charAt(0)?s.substr(1):s]=a)}return t},t.prototype.track=function(e,t){var n=t||{};this.logger.debug("track event of type",e,n);var o=this.makeEvent(e,"eventn",t||{});return this.sendJson(o)},t.prototype.init=function(e){var t,n,o=this;e||(e={}),this.initialOptions=e,this.logger=h(e.log_level?g[e.log_level]:void 0),this.logger.debug("Initializing eventN tracker",e,_),this.cookieDomain=e.cookie_domain||location.hostname.replace("www.",""),this.trackingHost=function(e){for(;n="/",-1!==(t=e).indexOf(n,t.length-n.length);)e=e.substr(0,e.length-1);var t,n;return 0===e.indexOf("https://")||0===e.indexOf("http://")?e:"//"+e}(e.tracking_host||"t.jitsu.com"),this.randomizeUrl=e.randomize_url||!1,this.idCookieName=e.cookie_name||"__eventn_id",this.apiKey=e.key||"NONE",this.userIdPersistance=new v(this.cookieDomain,this.idCookieName+"_usr"),!1===e.capture_3rd_party_cookies?this._3pCookies={}:(e.capture_3rd_party_cookies||["_ga","_fbp","_ym_uid","ajs_user_id","ajs_anonymous_id"]).forEach((function(e){return o._3pCookies[e]=!0})),e.ga_hook&&(t=this,void 0===n&&(n="ga"),d(n).then((function(e){e((function(e){var n=e.get("sendHitTask");e.set("sendHitTask",(function(e){var o=e.get("hitPayload");u?u=!1:n(e),t._send3p("ga",p(s(o)))}))})),u=!0;try{e("send","pageview")}finally{u=!1}})).catch((function(e){t.logger.error(e)}))),e.segment_hook&&function(e,t){void 0===t&&(t="analytics");d(t).then((function(t){t.__en_intercepted||e.interceptAnalytics(t)})).catch((function(t){e.logger.error("Can't get segment object",t)}))}(this),this.anonymousId=this.getAnonymousId(),this.initialized=!0},t.prototype.interceptAnalytics=function(t){var n=this;if(t&&"function"==typeof t.addSourceMiddleware){t.addSourceMiddleware((function(t){try{var o=e({},t.payload),i=t.integrations["Segment.io"];if(i&&i.analytics){var r=i.analytics;"function"==typeof r.user&&r.user()&&"function"==typeof r.user().id&&(o.obj.userId=r.user().id())}var s=t.payload.type();"track"===s&&(s=t.payload.event()),n._send3p("ajs",o,s)}catch(e){n.logger.warn("Failed to send an event",e)}t.next(t.payload)})),t.__en_intercepted=!0}else this.logger.error("analytics.addSourceMiddleware is not a function",t)},t.prototype.restoreId=function(){if(this.userIdPersistance){var t=this.userIdPersistance.restore();t&&(this.userProperties=e(e({},t),this.userProperties))}},t}();var f=window.eventN||{},y=f.eventsQ,w=void 0===y?[]:y;f.o;var k=function(e){window&&(window.__eventNDebug={clientVersion:_});var t=new m;return window&&(window.__eventNDebug.instance=t),e&&t.init(e),t}(window.eventNConfig||void 0);window.eventN=k,k.logger.debug("handling event queue",w);for(var b=0;b<w.length;b+=1){var N=w[b]||[],I=N[0],O=N.slice(1),C=k[I];"function"==typeof C&&C.apply(k,O)}}();
